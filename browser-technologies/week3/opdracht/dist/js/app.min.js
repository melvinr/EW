"use strict";var APP=APP||{};APP.launcher=function(){function t(){document.addEventListener("DOMContentLoaded",function(){APP.data.init()})}return{init:t}}(),APP.launcher.init();var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};APP.data=function(){function t(t){return new Promise(function(e,r){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onload=function(){this.status>=200&&this.status<300?e(n.response):r({status:this.status,statusText:n.statusText})},n.onerror=function(){r({status:this.status,statusText:n.statusText})},n.send()})}function e(){APP.data.request("../opdracht/dist/data/shirts.json").then(function(t){var e=JSON.parse(t);APP.router.init(e)})["catch"](function(t){console.error("Oops, there was an error!",t.statusText)})}function r(t){function e(){var t=this.getAttribute("data-id");o.push(t),this.classList.add("active"),this.innerHTML="Remove from favourites";for(var e=0;e<o.length;e++){for(var r=o[e],a=0,i=0;i<o.length;i++)o[i]==o[e]&&a++;if(a>1)for(var s=0;s<u.length;s++)u[s]==r&&(u.splice(s,1),s-=1,this.classList.remove("active"),console.log(this),this.innerHTML="Add to favourites")}console.log(u),n("shirtID",u)}var r=document.querySelectorAll(".favourite__btn");[].forEach.call(r,function(t){t.addEventListener("click",e,!1)})}function n(t,e){function r(t,e,r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3);var o="; expires="+n.toGMTString();document.cookie=t+"="+e+o+"; path=/"}function n(t){for(var e=t+"=",r=document.cookie.split(";"),n=0,o=r.length;o>n;n++){for(var a=r[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null}var o;try{localStorage.test=1,o=!0}catch(a){o=!1}if("undefined"!=typeof e&&null!==e&&("object"===("undefined"==typeof e?"undefined":_typeof(e))&&(e=JSON.stringify(e)),o?localStorage.setItem(t,e):r(t,e,30)),"undefined"==typeof e){o?data=localStorage.getItem(t):data=n(t);try{data=JSON.parse(data)}catch(a){data=data}return data}null===e&&(o?localStorage.removeItem(t):r(t,"",-1))}try{if(localStorage.test=1,null===localStorage.getItem("shirtID")){var o=[];console.log(o)}else{var o=JSON.parse(localStorage.getItem("shirtID"));console.log(o)}}catch(a){var i=function(t){for(var e=t+"=",r=document.cookie.split(";"),n=0,o=r.length;o>n;n++){for(var a=r[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null},s=i("shirtID");if(null===s)var o=[];else var o=JSON.parse(s);console.log(o)}var u=o;return{request:t,init:e,storage:r,storageFallback:n}}(),APP.page=function(){function t(t){APP.data.request("../opdracht/dist/templates/shirts.mst").then(function(e){n.innerHTML=Mustache.render(e,t),APP.data.storage()})["catch"](function(t){console.error("There was an error!",t.statusText)})}function e(t,e){var r=t.filter(function(t){return-1!=e.indexOf(t.id)});APP.data.request("../opdracht/dist/templates/shirt-detail.mst").then(function(t){n.innerHTML=Mustache.render(t,r),APP.data.storage()})["catch"](function(t){console.error("There was an error!",t.statusText)})}function r(t){try{localStorage.test=1;var e=localStorage.getItem("shirtID")}catch(r){var o=function(t){for(var e=t+"=",r=document.cookie.split(";"),n=0,o=r.length;o>n;n++){for(var a=r[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null},a=o("shirtID");if(null===a)var e=[];else var e=JSON.parse(a)}var i=t.filter(function(t){return-1!=e.indexOf(t.id)});APP.data.request("../opdracht/dist/templates/favourites.mst").then(function(t){n.innerHTML=Mustache.render(t,i),APP.data.storage()})["catch"](function(t){console.error("There was an error!",t.statusText)})}var n=document.querySelector("main");return{shirts:t,shirtDetail:e,favourites:r}}(),APP.router=function(){function t(t){window.location.hash||(window.location="#shirts"),routie({shirts:function(){APP.page.shirts(t)},"shirt-:ID":function(e){APP.page.shirtDetail(t,e)},favourites:function(){APP.page.favourites(t)}})}return{init:t}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5taW4uanMiLCJhcHBfbGF1bmNoZXItbW9kdWxlLmpzIiwiZGF0YS1tb2R1bGUuanMiLCJwYWdlLW1vZHVsZS5qcyIsInJvdXRlci1tb2R1bGUuanMiXSwibmFtZXMiOlsiQVBQIiwibGF1bmNoZXIiLCJpbml0IiwiZG9jdW1lbnQiLCJhZGRFdmVudExpc3RlbmVyIiwiZGF0YSIsIl90eXBlb2YiLCJTeW1ib2wiLCJpdGVyYXRvciIsIm9iaiIsImNvbnN0cnVjdG9yIiwicmVxdWVzdCIsInVybCIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvcGVuIiwib25sb2FkIiwidGhpcyIsInN0YXR1cyIsInJlc3BvbnNlIiwic3RhdHVzVGV4dCIsIm9uZXJyb3IiLCJzZW5kIiwidGhlbiIsIkpTT04iLCJwYXJzZSIsInJvdXRlciIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsInN0b3JhZ2UiLCJJRCIsInN0b3JlSUQiLCJjbGlja2VkSUQiLCJnZXRBdHRyaWJ1dGUiLCJhcnJheUlEIiwicHVzaCIsImNsYXNzTGlzdCIsImFkZCIsImlubmVySFRNTCIsImgiLCJsZW5ndGgiLCJjdXJJdGVtIiwiZm91bmRDb3VudCIsImkiLCJqIiwibmV3QXJyYXlJRCIsInNwbGljZSIsInJlbW92ZSIsImxvZyIsInN0b3JhZ2VGYWxsYmFjayIsIl9mYXZvdXJpdGVCdXR0b25zIiwicXVlcnlTZWxlY3RvckFsbCIsImZvckVhY2giLCJjYWxsIiwiYnV0dG9uIiwia2V5IiwidmFsdWUiLCJjcmVhdGVDb29raWUiLCJleHAiLCJkYXRlIiwiRGF0ZSIsInNldFRpbWUiLCJnZXRUaW1lIiwiZXhwaXJlcyIsInRvR01UU3RyaW5nIiwiY29va2llIiwicmVhZENvb2tpZSIsIm5hbWVFUSIsImNhIiwic3BsaXQiLCJtYXgiLCJjIiwiY2hhckF0Iiwic3Vic3RyaW5nIiwiaW5kZXhPZiIsImxzU3VwcG9ydCIsImxvY2FsU3RvcmFnZSIsInRlc3QiLCJlIiwic3RyaW5naWZ5Iiwic2V0SXRlbSIsImdldEl0ZW0iLCJyZW1vdmVJdGVtIiwiY29va2llSUQiLCJwYWdlIiwic2hpcnRzIiwidGVtcGxhdGUiLCJfbWFpblNlbGVjdG9yIiwiTXVzdGFjaGUiLCJyZW5kZXIiLCJzaGlydERldGFpbCIsImRldGFpbERhdGEiLCJmaWx0ZXIiLCJpZCIsImZhdm91cml0ZXMiLCJmYXZvdXJpdGVEYXRhIiwicXVlcnlTZWxlY3RvciIsIndpbmRvdyIsImxvY2F0aW9uIiwiaGFzaCIsInJvdXRpZSIsInNoaXJ0LTpJRCJdLCJtYXBwaW5ncyI6IkFBQUEsWUNHQSxJQUFJQSxLQUFNQSxPQUtWQSxLQUFJQyxTQUFZLFdBRVosUUFBU0MsS0FDTEMsU0FBU0MsaUJBQWlCLG1CQUFvQixXQUMxQ0osSUFBSUssS0FBS0gsU0FJakIsT0FDSUEsS0FBTUEsTUFLZEYsSUFBSUMsU0FBU0MsTURJYixJQUFJSSxTQUE0QixrQkFBWEMsU0FBb0QsZ0JBQXBCQSxRQUFPQyxTQUF3QixTQUFVQyxHQUFPLGFBQWNBLElBQVMsU0FBVUEsR0FBTyxNQUFPQSxJQUF5QixrQkFBWEYsU0FBeUJFLEVBQUlDLGNBQWdCSCxPQUFTLGVBQWtCRSxHRXZCMU9ULEtBQUlLLEtBQU8sV0FpQ1AsUUFBU00sR0FBUUMsR0FDYixNQUFPLElBQUlDLFNBQVEsU0FBVUMsRUFBU0MsR0FDbEMsR0FBSUMsR0FBTSxHQUFJQyxlQUNkRCxHQUFJRSxLQUFLLE1BQU9OLEdBQUssR0FDckJJLEVBQUlHLE9BQVMsV0FDTEMsS0FBS0MsUUFBVSxLQUFPRCxLQUFLQyxPQUFTLElBQ3BDUCxFQUFRRSxFQUFJTSxVQUVaUCxHQUNJTSxPQUFRRCxLQUFLQyxPQUNiRSxXQUFZUCxFQUFJTyxjQUk1QlAsRUFBSVEsUUFBVSxXQUNWVCxHQUNJTSxPQUFRRCxLQUFLQyxPQUNiRSxXQUFZUCxFQUFJTyxjQUd4QlAsRUFBSVMsU0FJWixRQUFTdkIsS0FDTEYsSUFBSUssS0FBS00sUUFBUSxxQ0FDWmUsS0FBSyxTQUFV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LFdBQ1QsUUFBUzNCLEdBQU1HLEdBQ05nRyxPQUFPQyxTQUFTQyxPQUNqQkYsT0FBT0MsU0FBVyxXQUV0QkUsUUFDSWYsT0FBVSxXQUNOekYsSUFBSXdGLEtBQUtDLE9BQU9wRixJQUVwQm9HLFlBQWEsU0FBU3ZFLEdBQ2xCbEMsSUFBSXdGLEtBQUtNLFlBQVl6RixFQUFNNkIsSUFFL0JnRSxXQUFjLFdBQ1ZsRyxJQUFJd0YsS0FBS1UsV0FBVzdGLE1BS2hDLE9BQ0lILEtBQU1BIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBcblx0TkFNRVNQQUNFIFxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xudmFyIEFQUCA9IEFQUCB8fCB7fTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBcbiAgICBMQVVOQ0ggQVBQXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAubGF1bmNoZXIgPSBmdW5jdGlvbiAoKSB7XG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwiRE9NQ29udGVudExvYWRlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBBUFAuZGF0YS5pbml0KCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0oKTtcblxuQVBQLmxhdW5jaGVyLmluaXQoKTtcblwidXNlIHN0cmljdFwiO1xuXG52YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBcblx0REFUQSBSRVFVRVNUXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAuZGF0YSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIC8qIExvY2FsIFN0b3JhZ2UgQ2hlY2tlciAoZWxzZTogY2hlY2sgY29va2llKSAqL1xuICAgIHRyeSB7XG4gICAgICAgIC8vIHNyYzogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvU3RhdGVtZW50cy90cnkuLi5jYXRjaFxuICAgICAgICBsb2NhbFN0b3JhZ2UudGVzdCA9IDE7XG4gICAgICAgIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInNoaXJ0SURcIikgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHZhciBhcnJheUlEID0gW107XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhhcnJheUlEKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBhcnJheUlEID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnc2hpcnRJRCcpKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGFycmF5SUQpO1xuICAgICAgICB9XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICB2YXIgcmVhZENvb2tpZSA9IGZ1bmN0aW9uIHJlYWRDb29raWUoa2V5KSB7XG4gICAgICAgICAgICB2YXIgbmFtZUVRID0ga2V5ICsgXCI9XCI7XG4gICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXggPSBjYS5sZW5ndGg7IGkgPCBtYXg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjID0gY2FbaV07XG4gICAgICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09PSAnICcpIHtcbiAgICAgICAgICAgICAgICAgICAgYyA9IGMuc3Vic3RyaW5nKDEsIGMubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICB9aWYgKGMuaW5kZXhPZihuYW1lRVEpID09PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH07XG5cbiAgICAgICAgdmFyIGNvb2tpZUlEID0gcmVhZENvb2tpZShcInNoaXJ0SURcIik7XG4gICAgICAgIGlmIChjb29raWVJRCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIGFycmF5SUQgPSBbXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBhcnJheUlEID0gSlNPTi5wYXJzZShjb29raWVJRCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coYXJyYXlJRCk7XG4gICAgfVxuICAgIHZhciBuZXdBcnJheUlEID0gYXJyYXlJRDtcblxuICAgIGZ1bmN0aW9uIHJlcXVlc3QodXJsKSB7XG4gICAgICAgIC8vIHNyYzogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8zMDAwODExNC9ob3ctZG8taS1wcm9taXNpZnktbmF0aXZlLXhoclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeGhyLm9wZW4oJ0dFVCcsIHVybCwgdHJ1ZSk7XG4gICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnN0YXR1cyA+PSAyMDAgJiYgdGhpcy5zdGF0dXMgPCAzMDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHRoaXMuc3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlamVjdCh7XG4gICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGhpcy5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgIHN0YXR1c1RleHQ6IHhoci5zdGF0dXNUZXh0XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeGhyLnNlbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4uL29wZHJhY2h0L2Rpc3QvZGF0YS9zaGlydHMuanNvbicpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IEpTT04ucGFyc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgQVBQLnJvdXRlci5pbml0KGRhdGEpO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdPb3BzLCB0aGVyZSB3YXMgYW4gZXJyb3IhJywgZXJyLnN0YXR1c1RleHQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc3RvcmFnZShJRCkge1xuXG4gICAgICAgIHZhciBfZmF2b3VyaXRlQnV0dG9ucyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5mYXZvdXJpdGVfX2J0bicpO1xuXG4gICAgICAgIFtdLmZvckVhY2guY2FsbChfZmF2b3VyaXRlQnV0dG9ucywgZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgICAgICAgLy92YXIgYnV0dG9uSUQgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9yZUlELCBmYWxzZSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGZ1bmN0aW9uIHN0b3JlSUQoKSB7XG4gICAgICAgICAgICB2YXIgY2xpY2tlZElEID0gdGhpcy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnKTtcbiAgICAgICAgICAgIGFycmF5SUQucHVzaChjbGlja2VkSUQpO1xuICAgICAgICAgICAgdGhpcy5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIHRoaXMuaW5uZXJIVE1MID0gJ1JlbW92ZSBmcm9tIGZhdm91cml0ZXMnO1xuXG4gICAgICAgICAgICAvKiAgQ0hFQ0sgRk9SIERVUExJQ0FURUQgSUQncyAtIHNyYzogaHR0cHM6Ly9qc2ZpZGRsZS5uZXQvQnVtYmxlQjJuYS9YdmdUYi8xLyAqL1xuICAgICAgICAgICAgZm9yICh2YXIgaCA9IDA7IGggPCBhcnJheUlELmxlbmd0aDsgaCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1ckl0ZW0gPSBhcnJheUlEW2hdLFxuICAgICAgICAgICAgICAgICAgICBmb3VuZENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAvLyBzZWFyY2ggYXJyYXkgZm9yIGl0ZW1cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5SUQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFycmF5SURbaV0gPT0gYXJyYXlJRFtoXSkgZm91bmRDb3VudCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoZm91bmRDb3VudCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHJlcGVhdGVkIGl0ZW0gZnJvbSBuZXcgYXJyYXlcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBuZXdBcnJheUlELmxlbmd0aDsgaisrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobmV3QXJyYXlJRFtqXSA9PSBjdXJJdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3QXJyYXlJRC5zcGxpY2UoaiwgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaiA9IGogLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2codGhpcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSAnQWRkIHRvIGZhdm91cml0ZXMnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2cobmV3QXJyYXlJRCk7XG4gICAgICAgICAgICAvL2xvY2FsU3RvcmFnZS5zZXRJdGVtKFwic2hpcnRJRFwiLCBKU09OLnN0cmluZ2lmeShuZXdBcnJheUlEKSk7XG4gICAgICAgICAgICBzdG9yYWdlRmFsbGJhY2soJ3NoaXJ0SUQnLCBuZXdBcnJheUlEKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc3RvcmFnZUZhbGxiYWNrKGtleSwgdmFsdWUpIHtcbiAgICAgICAgLy8gc3JjOiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9GbHVpZGJ5dGUvNDcxODM4MFxuICAgICAgICB2YXIgbHNTdXBwb3J0O1xuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2UudGVzdCA9IDE7XG4gICAgICAgICAgICBsc1N1cHBvcnQgPSB0cnVlO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsc1N1cHBvcnQgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIHZhbHVlIGlzIGRldGVjdGVkLCBzZXQgbmV3IG9yIG1vZGlmeSBzdG9yZVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcInVuZGVmaW5lZFwiICYmIHZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAvLyBDb252ZXJ0IG9iamVjdCB2YWx1ZXMgdG8gSlNPTlxuICAgICAgICAgICAgaWYgKCh0eXBlb2YgdmFsdWUgPT09IFwidW5kZWZpbmVkXCIgPyBcInVuZGVmaW5lZFwiIDogX3R5cGVvZih2YWx1ZSkpID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2V0IHRoZSBzdG9yZVxuICAgICAgICAgICAgaWYgKGxzU3VwcG9ydCkge1xuICAgICAgICAgICAgICAgIC8vIE5hdGl2ZSBzdXBwb3J0XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFVzZSBDb29raWVcbiAgICAgICAgICAgICAgICBjcmVhdGVDb29raWUoa2V5LCB2YWx1ZSwgMzApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTm8gdmFsdWUgc3VwcGxpZWQsIHJldHVybiB2YWx1ZVxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAvLyBHZXQgdmFsdWVcbiAgICAgICAgICAgIGlmIChsc1N1cHBvcnQpIHtcbiAgICAgICAgICAgICAgICAvLyBOYXRpdmUgc3VwcG9ydFxuICAgICAgICAgICAgICAgIGRhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBVc2UgY29va2llXG4gICAgICAgICAgICAgICAgZGF0YSA9IHJlYWRDb29raWUoa2V5KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gVHJ5IHRvIHBhcnNlIEpTT04uLi5cbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGRhdGE7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTnVsbCBzcGVjaWZpZWQsIHJlbW92ZSBzdG9yZVxuICAgICAgICBpZiAodmFsdWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmIChsc1N1cHBvcnQpIHtcbiAgICAgICAgICAgICAgICAvLyBOYXRpdmUgc3VwcG9ydFxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFVzZSBjb29raWVcbiAgICAgICAgICAgICAgICBjcmVhdGVDb29raWUoa2V5LCAnJywgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZXMgbmV3IGNvb2tpZSBvciByZW1vdmVzIGNvb2tpZSB3aXRoIG5lZ2F0aXZlIGV4cGlyYXRpb25cbiAgICAgICAgICogQHBhcmFtICBrZXkgICAgICAgVGhlIGtleSBvciBpZGVudGlmaWVyIGZvciB0aGUgc3RvcmVcbiAgICAgICAgICogQHBhcmFtICB2YWx1ZSAgICAgQ29udGVudHMgb2YgdGhlIHN0b3JlXG4gICAgICAgICAqIEBwYXJhbSAgZXhwICAgICAgIEV4cGlyYXRpb24gLSBjcmVhdGlvbiBkZWZhdWx0cyB0byAzMCBkYXlzXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVDb29raWUoa2V5LCB2YWx1ZSwgZXhwKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyBleHAgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgICAgIHZhciBleHBpcmVzID0gXCI7IGV4cGlyZXM9XCIgKyBkYXRlLnRvR01UU3RyaW5nKCk7XG4gICAgICAgICAgICBkb2N1bWVudC5jb29raWUgPSBrZXkgKyBcIj1cIiArIHZhbHVlICsgZXhwaXJlcyArIFwiOyBwYXRoPS9cIjtcbiAgICAgICAgfVxuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXR1cm5zIGNvbnRlbnRzIG9mIGNvb2tpZVxuICAgICAgICAgKiBAcGFyYW0gIGtleSAgICAgICBUaGUga2V5IG9yIGlkZW50aWZpZXIgZm9yIHRoZSBzdG9yZVxuICAgICAgICAgKi9cbiAgICAgICAgZnVuY3Rpb24gcmVhZENvb2tpZShrZXkpIHtcbiAgICAgICAgICAgIHZhciBuYW1lRVEgPSBrZXkgKyBcIj1cIjtcbiAgICAgICAgICAgIHZhciBjYSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1heCA9IGNhLmxlbmd0aDsgaSA8IG1heDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGMgPSBjYVtpXTtcbiAgICAgICAgICAgICAgICB3aGlsZSAoYy5jaGFyQXQoMCkgPT09ICcgJykge1xuICAgICAgICAgICAgICAgICAgICBjID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIH1pZiAoYy5pbmRleE9mKG5hbWVFUSkgPT09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LFxuICAgICAgICBpbml0OiBpbml0LFxuICAgICAgICBzdG9yYWdlOiBzdG9yYWdlLFxuICAgICAgICBzdG9yYWdlRmFsbGJhY2s6IHN0b3JhZ2VGYWxsYmFja1xuICAgIH07XG59KCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogXG5cdFBBR0UgTU9EVUxFIFt3aXRoIFByb21pc2VdXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAucGFnZSA9IGZ1bmN0aW9uICgpIHtcblxuICAgIHZhciBfbWFpblNlbGVjdG9yID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWFpbicpO1xuXG4gICAgZnVuY3Rpb24gc2hpcnRzKGRhdGEpIHtcbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdCgnLi4vb3BkcmFjaHQvZGlzdC90ZW1wbGF0ZXMvc2hpcnRzLm1zdCcpLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGF0YSk7XG4gICAgICAgICAgICBBUFAuZGF0YS5zdG9yYWdlKCk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZXJlIHdhcyBhbiBlcnJvciEnLCBlcnIuc3RhdHVzVGV4dCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBzaGlydERldGFpbChkYXRhLCBJRCkge1xuICAgICAgICB2YXIgZGV0YWlsRGF0YSA9IGRhdGEuZmlsdGVyKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gSUQuaW5kZXhPZihjLmlkKSAhPSAtMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdCgnLi4vb3BkcmFjaHQvZGlzdC90ZW1wbGF0ZXMvc2hpcnQtZGV0YWlsLm1zdCcpLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGV0YWlsRGF0YSk7XG4gICAgICAgICAgICBBUFAuZGF0YS5zdG9yYWdlKCk7XG4gICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZXJlIHdhcyBhbiBlcnJvciEnLCBlcnIuc3RhdHVzVGV4dCk7XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICBmdW5jdGlvbiBmYXZvdXJpdGVzKGRhdGEpIHtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnRlc3QgPSAxO1xuICAgICAgICAgICAgdmFyIElEID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NoaXJ0SUQnKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdmFyIHJlYWRDb29raWUgPSBmdW5jdGlvbiByZWFkQ29va2llKGtleSkge1xuICAgICAgICAgICAgICAgIHZhciBuYW1lRVEgPSBrZXkgKyBcIj1cIjtcbiAgICAgICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbWF4ID0gY2EubGVuZ3RoOyBpIDwgbWF4OyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGMgPSBjYVtpXTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09PSAnICcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1pZiAoYy5pbmRleE9mKG5hbWVFUSkgPT09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIGNvb2tpZUlEID0gcmVhZENvb2tpZShcInNoaXJ0SURcIik7XG4gICAgICAgICAgICBpZiAoY29va2llSUQgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2YXIgSUQgPSBbXTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIElEID0gSlNPTi5wYXJzZShjb29raWVJRCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9O1xuXG4gICAgICAgIC8qIEZpbHRlciBJRCAqL1xuICAgICAgICB2YXIgZmF2b3VyaXRlRGF0YSA9IGRhdGEuZmlsdGVyKGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gSUQuaW5kZXhPZihjLmlkKSAhPSAtMTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdCgnLi4vb3BkcmFjaHQvZGlzdC90ZW1wbGF0ZXMvZmF2b3VyaXRlcy5tc3QnKS50aGVuKGZ1bmN0aW9uICh0ZW1wbGF0ZSkge1xuICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGZhdm91cml0ZURhdGEpO1xuICAgICAgICAgICAgQVBQLmRhdGEuc3RvcmFnZSgpO1xuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSB3YXMgYW4gZXJyb3IhJywgZXJyLnN0YXR1c1RleHQpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2hpcnRzOiBzaGlydHMsXG4gICAgICAgIHNoaXJ0RGV0YWlsOiBzaGlydERldGFpbCxcbiAgICAgICAgZmF2b3VyaXRlczogZmF2b3VyaXRlc1xuICAgIH07XG59KCk7XG4ndXNlIHN0cmljdCc7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogIFxuXHRST1VURVIgTU9EVUxFIFt3aXRoIHJvdXRlciBsaWI6IFJvdXRpZV1cbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbkFQUC5yb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gaW5pdChkYXRhKSB7XG4gICAgICAgIGlmICghd2luZG93LmxvY2F0aW9uLmhhc2gpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcjc2hpcnRzJztcbiAgICAgICAgfVxuICAgICAgICByb3V0aWUoe1xuICAgICAgICAgICAgJ3NoaXJ0cyc6IGZ1bmN0aW9uIHNoaXJ0cygpIHtcbiAgICAgICAgICAgICAgICBBUFAucGFnZS5zaGlydHMoZGF0YSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ3NoaXJ0LTpJRCc6IGZ1bmN0aW9uIHNoaXJ0SUQoSUQpIHtcbiAgICAgICAgICAgICAgICBBUFAucGFnZS5zaGlydERldGFpbChkYXRhLCBJRCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2Zhdm91cml0ZXMnOiBmdW5jdGlvbiBmYXZvdXJpdGVzKCkge1xuICAgICAgICAgICAgICAgIEFQUC5wYWdlLmZhdm91cml0ZXMoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbn0oKTsiLCIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIFxuXHROQU1FU1BBQ0UgXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG52YXIgQVBQID0gQVBQIHx8IHt9O1xuXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIFxuICAgIExBVU5DSCBBUFBcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8gXG5BUFAubGF1bmNoZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgICBcbiAgICBmdW5jdGlvbiBpbml0KCkgeyAgICAgXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uICgpIHsgXG4gICAgICAgICAgICBBUFAuZGF0YS5pbml0KCk7XG4gICAgICAgIH0pOyAgICAgICAgICAgIFxuICAgIH07ICAgIFxuICAgIFxuICAgIHJldHVybiB7IFxuICAgICAgICBpbml0OiBpbml0XG4gICAgfTtcbiAgICBcbn0oKSk7XG5cbkFQUC5sYXVuY2hlci5pbml0KCk7IiwiLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiBcblx0REFUQSBSRVFVRVNUXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovICBcbkFQUC5kYXRhID0gKGZ1bmN0aW9uICgpIHtcbiAgICBcbiAgICAvKiBMb2NhbCBTdG9yYWdlIENoZWNrZXIgKGVsc2U6IGNoZWNrIGNvb2tpZSkgKi9cbiAgICB0cnkgeyAvLyBzcmM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL1N0YXRlbWVudHMvdHJ5Li4uY2F0Y2hcbiAgICAgICAgbG9jYWxTdG9yYWdlLnRlc3QgPSAxO1xuICAgICAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJzaGlydElEXCIpID09PSBudWxsKSB7XG4gICAgICAgICAgICB2YXIgYXJyYXlJRCA9IFtdO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYXJyYXlJRCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgYXJyYXlJRCA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NoaXJ0SUQnKSk7IFxuICAgICAgICAgICAgY29uc29sZS5sb2coYXJyYXlJRCk7XG4gICAgICAgIH1cbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGZ1bmN0aW9uIHJlYWRDb29raWUoa2V5KSB7XG4gICAgICAgICAgICB2YXIgbmFtZUVRID0ga2V5ICsgXCI9XCI7XG4gICAgICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBtYXggPSBjYS5sZW5ndGg7IGkgPCBtYXg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjID0gY2FbaV07XG4gICAgICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApID09PSAnICcpIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgaWYgKGMuaW5kZXhPZihuYW1lRVEpID09PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0gXG4gICAgICAgIHZhciBjb29raWVJRCA9IHJlYWRDb29raWUoXCJzaGlydElEXCIpOyAgIFxuICAgICAgICBpZiAoY29va2llSUQgPT09IG51bGwpIHsgXG4gICAgICAgICAgICB2YXIgYXJyYXlJRCA9IFtdO1xuICAgICAgICB9IGVsc2UgeyBcbiAgICAgICAgICAgIHZhciBhcnJheUlEID0gSlNPTi5wYXJzZShjb29raWVJRCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coYXJyYXlJRCk7XG4gICAgfSAgICBcbiAgICB2YXIgbmV3QXJyYXlJRCA9IGFycmF5SUQ7XG4gICAgXG4gICAgZnVuY3Rpb24gcmVxdWVzdCh1cmwpIHsgLy8gc3JjOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzMwMDA4MTE0L2hvdy1kby1pLXByb21pc2lmeS1uYXRpdmUteGhyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgICAgICB4aHIub3BlbignR0VUJywgdXJsLCB0cnVlKTtcbiAgICAgICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhdHVzID49IDIwMCAmJiB0aGlzLnN0YXR1cyA8IDMwMCkge1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogdGhpcy5zdGF0dXMsXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiB4aHIuc3RhdHVzVGV4dFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgeGhyLm9uZXJyb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiB0aGlzLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogeGhyLnN0YXR1c1RleHRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB4aHIuc2VuZCgpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdCgnLi4vb3BkcmFjaHQvZGlzdC9kYXRhL3NoaXJ0cy5qc29uJylcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgQVBQLnJvdXRlci5pbml0KGRhdGEpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignT29wcywgdGhlcmUgd2FzIGFuIGVycm9yIScsIGVyci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pO1xuICAgIH07XG4gICAgXG4gICAgZnVuY3Rpb24gc3RvcmFnZShJRCkgeyBcbiAgICBcbiAgICAgICAgdmFyIF9mYXZvdXJpdGVCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmZhdm91cml0ZV9fYnRuJyk7XG4gICAgICAgIFxuICAgICAgICBbXS5mb3JFYWNoLmNhbGwoX2Zhdm91cml0ZUJ1dHRvbnMsIGZ1bmN0aW9uKGJ1dHRvbikge1xuICAgICAgICAgICAgLy92YXIgYnV0dG9uSUQgPSBidXR0b24uZ2V0QXR0cmlidXRlKCdkYXRhLWlkJyk7XG4gICAgICAgICAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBzdG9yZUlELCBmYWxzZSk7XG4gICAgICAgIH0pOyAgICAgICBcbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBzdG9yZUlEKCkgeyAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBjbGlja2VkSUQgPSB0aGlzLmdldEF0dHJpYnV0ZSgnZGF0YS1pZCcpO1xuICAgICAgICAgICAgYXJyYXlJRC5wdXNoKGNsaWNrZWRJRCk7XG4gICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgdGhpcy5pbm5lckhUTUwgPSAnUmVtb3ZlIGZyb20gZmF2b3VyaXRlcyc7XG5cbiAgICAgICAgICAgIC8qICBDSEVDSyBGT1IgRFVQTElDQVRFRCBJRCdzIC0gc3JjOiBodHRwczovL2pzZmlkZGxlLm5ldC9CdW1ibGVCMm5hL1h2Z1RiLzEvICovXG4gICAgICAgICAgICBmb3IodmFyIGggPSAwOyBoIDwgYXJyYXlJRC5sZW5ndGg7IGgrKykgeyBcbiAgICAgICAgICAgICAgICB2YXIgY3VySXRlbSA9IGFycmF5SURbaF0sXG4gICAgICAgICAgICAgICAgICAgIGZvdW5kQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIC8vIHNlYXJjaCBhcnJheSBmb3IgaXRlbVxuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBhcnJheUlELmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhcnJheUlEW2ldID09IGFycmF5SURbaF0pXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZENvdW50Kys7ICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZihmb3VuZENvdW50ID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgcmVwZWF0ZWQgaXRlbSBmcm9tIG5ldyBhcnJheVxuICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGogPSAwOyBqIDwgbmV3QXJyYXlJRC5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYobmV3QXJyYXlJRFtqXSA9PSBjdXJJdGVtKSB7ICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0FycmF5SUQuc3BsaWNlKGosIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGogPSBqIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaW5uZXJIVE1MID0gJ0FkZCB0byBmYXZvdXJpdGVzJztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07ICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhuZXdBcnJheUlEKTtcbiAgICAgICAgICAgIC8vbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJzaGlydElEXCIsIEpTT04uc3RyaW5naWZ5KG5ld0FycmF5SUQpKTtcbiAgICAgICAgICAgIHN0b3JhZ2VGYWxsYmFjaygnc2hpcnRJRCcsIG5ld0FycmF5SUQpO1xuICAgICAgICB9OyBcbiAgICB9O1xuICAgIFxuICAgIGZ1bmN0aW9uIHN0b3JhZ2VGYWxsYmFjayAoa2V5LCB2YWx1ZSkgeyAvLyBzcmM6IGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL0ZsdWlkYnl0ZS80NzE4MzgwXG4gICAgICAgIHZhciBsc1N1cHBvcnQ7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS50ZXN0ID0gMTtcbiAgICAgICAgICAgIGxzU3VwcG9ydCA9IHRydWU7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGxzU3VwcG9ydCA9IGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdmFsdWUgaXMgZGV0ZWN0ZWQsIHNldCBuZXcgb3IgbW9kaWZ5IHN0b3JlXG4gICAgICAgIGlmICh0eXBlb2YgdmFsdWUgIT09IFwidW5kZWZpbmVkXCIgJiYgdmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIENvbnZlcnQgb2JqZWN0IHZhbHVlcyB0byBKU09OXG4gICAgICAgICAgICBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgKSB7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBTZXQgdGhlIHN0b3JlXG4gICAgICAgICAgICBpZiAobHNTdXBwb3J0KSB7IC8vIE5hdGl2ZSBzdXBwb3J0XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICB9IGVsc2UgeyAvLyBVc2UgQ29va2llXG4gICAgICAgICAgICAgICAgY3JlYXRlQ29va2llKGtleSwgdmFsdWUsIDMwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIHZhbHVlIHN1cHBsaWVkLCByZXR1cm4gdmFsdWVcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgLy8gR2V0IHZhbHVlXG4gICAgICAgICAgICBpZiAobHNTdXBwb3J0KSB7IC8vIE5hdGl2ZSBzdXBwb3J0XG4gICAgICAgICAgICAgICAgZGF0YSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICAgICAgICB9IGVsc2UgeyAvLyBVc2UgY29va2llIFxuICAgICAgICAgICAgICAgIGRhdGEgPSByZWFkQ29va2llKGtleSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFRyeSB0byBwYXJzZSBKU09OLi4uXG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaChlKSB7XG4gICAgICAgICAgICAgICBkYXRhID0gZGF0YTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE51bGwgc3BlY2lmaWVkLCByZW1vdmUgc3RvcmVcbiAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICBpZiAobHNTdXBwb3J0KSB7IC8vIE5hdGl2ZSBzdXBwb3J0XG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICAgICAgICAgIH0gZWxzZSB7IC8vIFVzZSBjb29raWVcbiAgICAgICAgICAgICAgICBjcmVhdGVDb29raWUoa2V5LCAnJywgLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIENyZWF0ZXMgbmV3IGNvb2tpZSBvciByZW1vdmVzIGNvb2tpZSB3aXRoIG5lZ2F0aXZlIGV4cGlyYXRpb25cbiAgICAgICAgICogQHBhcmFtICBrZXkgICAgICAgVGhlIGtleSBvciBpZGVudGlmaWVyIGZvciB0aGUgc3RvcmVcbiAgICAgICAgICogQHBhcmFtICB2YWx1ZSAgICAgQ29udGVudHMgb2YgdGhlIHN0b3JlXG4gICAgICAgICAqIEBwYXJhbSAgZXhwICAgICAgIEV4cGlyYXRpb24gLSBjcmVhdGlvbiBkZWZhdWx0cyB0byAzMCBkYXlzXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVDb29raWUoa2V5LCB2YWx1ZSwgZXhwKSB7XG4gICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICBkYXRlLnNldFRpbWUoZGF0ZS5nZXRUaW1lKCkgKyAoZXhwICogMjQgKiA2MCAqIDYwICogMTAwMCkpO1xuICAgICAgICAgICAgdmFyIGV4cGlyZXMgPSBcIjsgZXhwaXJlcz1cIiArIGRhdGUudG9HTVRTdHJpbmcoKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmNvb2tpZSA9IGtleSArIFwiPVwiICsgdmFsdWUgKyBleHBpcmVzICsgXCI7IHBhdGg9L1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIFJldHVybnMgY29udGVudHMgb2YgY29va2llXG4gICAgICAgICAqIEBwYXJhbSAga2V5ICAgICAgIFRoZSBrZXkgb3IgaWRlbnRpZmllciBmb3IgdGhlIHN0b3JlXG4gICAgICAgICAqL1xuICAgICAgICBmdW5jdGlvbiByZWFkQ29va2llKGtleSkge1xuICAgICAgICAgICAgdmFyIG5hbWVFUSA9IGtleSArIFwiPVwiO1xuICAgICAgICAgICAgdmFyIGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbWF4ID0gY2EubGVuZ3RoOyBpIDwgbWF4OyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGNhW2ldO1xuICAgICAgICAgICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PT0gJyAnKSBjID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgIGlmIChjLmluZGV4T2YobmFtZUVRKSA9PT0gMCkgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWVFUS5sZW5ndGgsIGMubGVuZ3RoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9ICAgICAgICBcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVxdWVzdDogcmVxdWVzdCxcbiAgICAgICAgaW5pdDogaW5pdCxcbiAgICAgICAgc3RvcmFnZTogc3RvcmFnZSxcbiAgICAgICAgc3RvcmFnZUZhbGxiYWNrOiBzdG9yYWdlRmFsbGJhY2tcbiAgICB9O1xuXG59KSgpOyIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogXG5cdFBBR0UgTU9EVUxFIFt3aXRoIFByb21pc2VdXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovXG5BUFAucGFnZSA9IChmdW5jdGlvbiAoKSB7XG5cbiAgICB2YXIgX21haW5TZWxlY3RvciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKTtcblxuICAgIGZ1bmN0aW9uIHNoaXJ0cyhkYXRhKSB7XG4gICAgICAgIEFQUC5kYXRhLnJlcXVlc3QoJy4uL29wZHJhY2h0L2Rpc3QvdGVtcGxhdGVzL3NoaXJ0cy5tc3QnKVxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRlbXBsYXRlKSB7XG4gICAgICAgICAgICAgICAgX21haW5TZWxlY3Rvci5pbm5lckhUTUwgPSBNdXN0YWNoZS5yZW5kZXIodGVtcGxhdGUsIGRhdGEpO1xuICAgICAgICAgICAgICAgIEFQUC5kYXRhLnN0b3JhZ2UoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZXJlIHdhcyBhbiBlcnJvciEnLCBlcnIuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc2hpcnREZXRhaWwoZGF0YSwgSUQpIHtcbiAgICAgICAgdmFyIGRldGFpbERhdGEgPSBkYXRhLmZpbHRlcihmdW5jdGlvbihjKSB7XG4gICAgICAgICAgICAgcmV0dXJuIElELmluZGV4T2YoYy5pZCkgIT0gLTFcbiAgICAgICAgfSkgICAgICAgIFxuICAgICAgICBcbiAgICAgICAgQVBQLmRhdGEucmVxdWVzdCgnLi4vb3BkcmFjaHQvZGlzdC90ZW1wbGF0ZXMvc2hpcnQtZGV0YWlsLm1zdCcpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodGVtcGxhdGUpIHtcbiAgICAgICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZGV0YWlsRGF0YSk7XG4gICAgICAgICAgICAgICAgQVBQLmRhdGEuc3RvcmFnZSgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignVGhlcmUgd2FzIGFuIGVycm9yIScsIGVyci5zdGF0dXNUZXh0KTtcbiAgICAgICAgICAgIH0pOyAgICAgICAgXG4gICAgfTtcbiAgICBcbiAgICBmdW5jdGlvbiBmYXZvdXJpdGVzKGRhdGEpIHtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnRlc3QgPSAxO1xuICAgICAgICAgICAgdmFyIElEID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3NoaXJ0SUQnKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgZnVuY3Rpb24gcmVhZENvb2tpZShrZXkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmFtZUVRID0ga2V5ICsgXCI9XCI7XG4gICAgICAgICAgICAgICAgdmFyIGNhID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7Jyk7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1heCA9IGNhLmxlbmd0aDsgaSA8IG1heDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjID0gY2FbaV07XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlIChjLmNoYXJBdCgwKSA9PT0gJyAnKSBjID0gYy5zdWJzdHJpbmcoMSwgYy5sZW5ndGgpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYy5pbmRleE9mKG5hbWVFUSkgPT09IDApIHJldHVybiBjLnN1YnN0cmluZyhuYW1lRVEubGVuZ3RoLCBjLmxlbmd0aCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIHZhciBjb29raWVJRCA9IHJlYWRDb29raWUoXCJzaGlydElEXCIpOyAgIFxuICAgICAgICAgICAgaWYgKGNvb2tpZUlEID09PSBudWxsKSB7IFxuICAgICAgICAgICAgICAgIHZhciBJRCA9IFtdO1xuICAgICAgICAgICAgfSBlbHNlIHsgXG4gICAgICAgICAgICAgICAgdmFyIElEID0gSlNPTi5wYXJzZShjb29raWVJRCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9OyAgICAgICAgXG4gICAgICAgIFxuICAgICAgICAvKiBGaWx0ZXIgSUQgKi9cbiAgICAgICAgdmFyIGZhdm91cml0ZURhdGEgPSBkYXRhLmZpbHRlcihmdW5jdGlvbihjKSB7ICAgIFxuICAgICAgICAgICAgcmV0dXJuIElELmluZGV4T2YoYy5pZCkgIT0gLTFcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBBUFAuZGF0YS5yZXF1ZXN0KCcuLi9vcGRyYWNodC9kaXN0L3RlbXBsYXRlcy9mYXZvdXJpdGVzLm1zdCcpXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAodGVtcGxhdGUpIHtcbiAgICAgICAgICAgICAgICBfbWFpblNlbGVjdG9yLmlubmVySFRNTCA9IE11c3RhY2hlLnJlbmRlcih0ZW1wbGF0ZSwgZmF2b3VyaXRlRGF0YSk7IFxuICAgICAgICAgICAgICAgIEFQUC5kYXRhLnN0b3JhZ2UoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZXJlIHdhcyBhbiBlcnJvciEnLCBlcnIuc3RhdHVzVGV4dCk7XG4gICAgICAgICAgICB9KTsgICAgICAgICAgXG4gICAgfTsgICAgICAgXG5cbiAgICByZXR1cm4ge1xuICAgICAgICBzaGlydHM6IHNoaXJ0cyxcbiAgICAgICAgc2hpcnREZXRhaWw6IHNoaXJ0RGV0YWlsLFxuICAgICAgICBmYXZvdXJpdGVzOiBmYXZvdXJpdGVzXG4gICAgfTtcblxufSkoKTsiLCIvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICBcblx0Uk9VVEVSIE1PRFVMRSBbd2l0aCByb3V0ZXIgbGliOiBSb3V0aWVdXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovICAgICAgXG5BUFAucm91dGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBpbml0IChkYXRhKSB7XG4gICAgICAgIGlmICghd2luZG93LmxvY2F0aW9uLmhhc2gpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9ICcjc2hpcnRzJztcbiAgICAgICAgfSAgICAgICAgICAgIFxuICAgICAgICByb3V0aWUoe1xuICAgICAgICAgICAgJ3NoaXJ0cyc6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIEFQUC5wYWdlLnNoaXJ0cyhkYXRhKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAnc2hpcnQtOklEJzogZnVuY3Rpb24oSUQpIHtcbiAgICAgICAgICAgICAgICBBUFAucGFnZS5zaGlydERldGFpbChkYXRhLCBJRCk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgJ2Zhdm91cml0ZXMnOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBBUFAucGFnZS5mYXZvdXJpdGVzKGRhdGEpO1xuICAgICAgICAgICAgfSAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICAgIGluaXQ6IGluaXRcbiAgICB9OyAgICAgXG4gICAgXG59KSgpO1xuICAgICJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
